"use strict";(self.webpackChunkjavascript_framework_shop=self.webpackChunkjavascript_framework_shop||[]).push([[301],{459:(t,e,s)=>{s.d(e,{Z:()=>o});var a=s(771),n=s(554);const{addBid:i}=n.default;class o extends a.Z{constructor(){super(),this._init()}get _template(){return'\n      <div class="main-modal">\n        <div class="main-modal__wrap" data-el="overlay">\n          <div class="main-modal__content">\n            <h2 class="main-modal__title">\n              Заявка на бронирование\n              <b>Квартира 96 в Первом квартале Дом 5</b>\n            </h2>\n            <p class="main-modal__art">ГЕН-112-42</p>\n\n            <form class="main-modal__form" data-el="form">\n              <p class="main-modal__field">\n                <label for="name" class="main-modal__label">Имя</label>\n                <input id="name" class="main-modal__input" type="text" name="name" placeholder="Введите имя" autocomplete="off" required>\n              </p>\n              <p class="main-modal__field">\n                <label for="phone" class="main-modal__label">Телефон</label>\n                <input id="phone" class="main-modal__input" type="tel" name="phone" placeholder="+7 (XXX) XXX-XX-XX" autocomplete="off" required>\n              </p>\n              <p class="main-modal__field main-modal__field--agree">\n                <input id="agree" class="main-modal__checkbox" type="checkbox" name="agree" checked required>\n                <label for="agree" class="main-modal__label">Я согласен на обработку моих персональных данных. С Политикой в отношении обработки персональных данных ознакомлен и согласен.</label>\n              </p>\n              <p class="main-modal__field main-modal__field--message" data-el="message"></p>\n\n              <button class="main-modal__button" type="submit" data-el="submit">Отправить заявку</button>\n            </form>\n\n            <button class="main-modal__close" type="button" data-el="close">Закрыть</button>\n          </div>\n        </div>\n      </div>\n    '}_initListeners(){this._elements.close.addEventListener("click",(()=>{this.destroy()})),this._elements.overlay.addEventListener("click",(t=>{t.target.closest(".main-modal__content")||this.destroy()})),this._elements.submit.addEventListener("click",(async t=>{t.preventDefault();const e=new FormData(this._elements.form),[s,a,n]=[e.get("name"),e.get("phone"),e.get("agree")];if(!n)return void(this._elements.message.innerHTML="Нужно согласиться на условия!");const o=await i(JSON.stringify({name:s,phone:a}));this._elements.message.innerHTML="",o.errors?this._elements.message.innerHTML=o.errors.reduce(((t,e)=>t+`${e}<br>`),""):(this._elements.form.innerHTML="Сообщение отправлено!",this._elements.form.style.color="green")}))}}},771:(t,e,s)=>{s.d(e,{Z:()=>a});class a{_component=null;_elements={};_components={};_abortController=new AbortController;constructor(){if("BaseComponent"===this.constructor.name)throw new TypeError("Абстрактный класс!")}get _template(){return""}get component(){return this._component}get elements(){return this._elements}_setComponents(t){this._components=t}_reloadComponents(t){this._setComponents(t),this._initComponents()}_init(){this._beforeInit().then(),this._initComponent(),this._initElements(),this._initComponents(),this._initListeners(),this._afterInit().then()}async _beforeInit(){}async _afterInit(){}_loadData(){}_updateData(){}_initComponent(){const t=document.createElement("div");t.innerHTML=this._template,this._component=t.firstElementChild||t}_initElements(t=this._component){t.querySelectorAll("[data-el]").forEach((t=>{const e=t.dataset.el;this._elements[e]=t}))}_initComponents(){for(const t of Object.keys(this._components)){let e=this._elements[t];const{component:s}="object"!=typeof this._components[t]||Array.isArray(this._components[t])?new this._components[t]:this._components[t];e&&s&&(s.dataset.el=e.dataset.el,this._elements[e.dataset.el]=s,e.insertAdjacentElement("beforebegin",s),e.remove(),e=null,this._initElements(s))}}_initListeners(){}update(t={}){for(const[e,s]of Object.entries(t))this._elements[e]&&(this._elements[e].innerHTML=s)}destroy(){this._remove(),this._removeListeners()}_remove(){this._component.innerHTML="",this._elements={}}_removeListeners(){this._abortController.abort()}}},44:(t,e,s)=>{s.d(e,{Z:()=>n});var a=s(771);class n extends a.Z{_layout=s.e(220).then(s.bind(s,220));_title="JavaScript framework";constructor(){super(),document.title="Главая страница"}get layout(){return this._layout}}},141:(t,e,s)=>{s.d(e,{Z:()=>a});class a{static _initialization=!1;_options={};_baseUrl="";constructor(){if(!a._initialization)throw new TypeError("Нельзя напрямую создать экземпляр данного класса")}static create(t={}){a._initialization=!0;const e=new a;return a._initialization=!1,e._baseUrl=t.baseUrl??"",delete t.baseUrl,e._options=t,e}_response=async(t,e={})=>{try{const s=await fetch(t,e);return await s.json()}catch(t){throw t}};get(t=""){return t=new URL(t,this._baseUrl),this._response(t.href,this._options)}post(t="",e={}){return t=new URL(t,this._baseUrl),this._options={...this._options,method:"post",body:e},this._response(t.href,this._options)}}},215:(t,e,s)=>{s.d(e,{Z:()=>a});class a{_reducers=[];_state={};_listeners={};constructor(t=[],e={}){this._reducers=t,this._state=e}getState(t=""){return this._state[t]?this._state[t]:this._state}_setState(t){this._state=t}subscribe(t,e){return this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),()=>{this._listeners=this._listeners[t].filter((t=>t!==e))}}dispatch(t){for(const e of this._reducers){const s=e(this.getState(),t);if(s){this._setState(s);const e=this._listeners[t.type];if(e){const t=this.getState();for(const s of e)s(t)}}}}}},301:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.r(e),s.d(e,{default:()=>p});var n=s(44),i=s(42),o=s(598),r=s(459),l=s(319),d=s(214),c=t([l]);l=(c.then?(await c)():c)[0];const{loadProduct:_}=i.default;class p extends n.Z{_id=null;_data={};constructor({item:t}){super(),document.title=`Страница продукта - ${this._title}`,this._id=t,this._init()}async _afterInit(){await this._loadData(),await this._updateData()}async _loadData(){this._data.product=await _(this._id)}async _updateData(){const{product:t}=this._data;document.title=`${t.title} - ${this._title}`,l.Z.subscribe(d.Uw,(()=>{this._toggleButtonFavourite()})),this._toggleButtonFavourite(),this.update({title:this._heading(t),image:this._image(t),sector:this._sector(t.complex_name),subtitle:this._subtitle(t),art:t.scu,building:t.building,floor:t.floor,flatNumber:t.flat_number,rooms:t.rooms,priceTotal:`${(0,o.X)(t.price_total)} ₸`,priceSq:`${(0,o.X)(t.price_sq_m)} ₸/м<sup>2</sup>`,square:`${t.square} м<sup>2</sup>`})}_toggleButtonFavourite(){l.Z.getState("favourites").includes(this._id)?this._elements.favourite.classList.add("product-page__favorite--active"):this._elements.favourite.classList.remove("product-page__favorite--active")}get _template(){return'\n      <div class="product-page">\n        <div class="container">\n          <h1 class="product-page__title" data-el="title">Загрузка...</h1>\n\n          <div class="product-page__content">\n            <p class="product-page__pic" data-el="image">\n              Загрузка...\n            </p>\n\n            <div class="product-page__info">\n              <div class="product-page__info-primary">\n                <b class="product-page__sector" data-el="sector">Загрузка...</b>\n                <h2 class="product-page__subtitle" data-el="subtitle">Загрузка...</h2>\n                <p class="product-page__art" data-el="art">Загрузка...</p>\n                <button class="product-page__favorite" type="button" data-el="favourite">\n                  <svg width="24" height="24"><use xlink:href="#icon-heart"></use></svg>\n                  В избранное\n                </button>\n              </div>\n\n              <div class="product-page__info-secondary">\n                <dl class="product-page__param">\n                  <dt class="product-page__param-title">Корпус</dt>\n                  <dd class="product-page__param-desc" data-el="building"></dd>\n                  <dt class="product-page__param-title">Этаж</dt>\n                  <dd class="product-page__param-desc" data-el="floor"></dd>\n                  <dt class="product-page__param-title">Номер</dt>\n                  <dd class="product-page__param-desc" data-el="flatNumber"></dd>\n                  <dt class="product-page__param-title">Комнат</dt>\n                  <dd class="product-page__param-desc" data-el="rooms"></dd>\n                </dl>\n\n                <div class="product-page__detail">\n                  <dt class="product-page__detail-title">Стоимость</dt>\n                  <dd class="product-page__detail-desc product-page__detail-title--big" data-el="priceTotal">Загрузка...</dd>\n                  <dt class="product-page__detail-title">Цена за м<sup>2</sup></dt>\n                  <dd class="product-page__detail-desc" data-el="priceSq">Загрузка...</dd>\n                  <dt class="product-page__detail-title">Площадь</dt>\n                  <dd class="product-page__detail-desc" data-el="square">Загрузка...</dd>\n                </div>\n\n                <button class="product-page__buy" type="button" data-el="buy">Забронировать</button>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div data-el="modal"></div>\n      </div>\n    '}_heading(t){return`${t.title}, ${t.square} м<sup>2</sup> за ${(0,o.X)(t.price_total)} ₸`}_image(t){return`<img class="product-page__img" src="${t.image}" width="500" height="500" alt="${t.title}">`}_sector(t){return`ЖК ${t}`}_subtitle(t){return`${t.title}, ${t.square} м<sup>2</sup>`}_initListeners(){this._elements.buy.addEventListener("click",(()=>{this._reloadComponents({modal:r.Z})})),this._elements.favourite.addEventListener("click",(async()=>{l.Z.dispatch((0,d.IR)(this._id))}))}}a()}catch(t){a(t)}}))},156:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.d(e,{GW:()=>d,YU:()=>l,pA:()=>o,sH:()=>i});var n=s(554);const{loadBids:t}=n.default,i="REFRESH_BIDS",o=t=>({type:i,bids:t}),r=await t(),l={bids:r,countBids:r.length},d=(t,e)=>e.type===i?(t.bids=e.bids,{...t}):null;a()}catch(t){a(t)}}),1)},214:(t,e,s)=>{s.d(e,{Ap:()=>i,Hn:()=>o,IR:()=>n,Uw:()=>a});const a="TOGGLE_FAVOURITE",n=t=>({type:a,favourite:t}),i={favourites:JSON.parse(localStorage.getItem("favourites"))??[]},o=(t,e)=>{if(e.type===a){if(t.favourites.includes(e.favourite)){const s=t.favourites.filter((t=>t!==e.favourite));return localStorage.setItem("favourites",JSON.stringify(s)),{...t,favourites:s}}return t.favourites.push(e.favourite),localStorage.setItem("favourites",JSON.stringify(t.favourites)),{...t}}return null}},715:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.d(e,{LY:()=>_,MN:()=>l,U3:()=>c,Xm:()=>o,dj:()=>i,dq:()=>r,sx:()=>d,uD:()=>p});var n=s(42);const{loadAllProducts:t}=n.default,i="SUBMIT_FILTER",o="RESET_FILTER",r="SORT_FILTER",l=t=>({type:i,product:t}),d=()=>({type:o}),c=t=>({type:r,product:t}),_={products:await t()},p=(t,e)=>{switch(e.type){case i:case r:return t.products=e.product,{...t};case o:return{...t,..._};default:return null}};a()}catch(t){a(t)}}),1)},838:(t,e,s)=>{s.d(e,{dw:()=>o,kI:()=>n,v7:()=>i,xe:()=>a});const a="SORT_PRODUCT",n=t=>({type:a,product:t}),i={directions:{complex:"asc",rooms:"asc",square:"asc",priceSqM:"asc",priceTotal:"asc"}},o=(t,e)=>e.type===a?(t.products=e.product,{...t}):null},554:(t,e,s)=>{s.d(e,{default:()=>o});var a=s(141);const n=a.Z.create({baseUrl:"https://jsproject.webcademy.ru",credentials:"omit",headers:{"Content-Type":"application/json; charset=UTF-8"}}),i=a.Z.create({baseUrl:"https://jsproject.webcademy.ru",credentials:"omit",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),o={addBid:t=>n.post("/bidnew",t),loadBids:()=>i.get("/bids")}},42:(t,e,s)=>{s.d(e,{default:()=>n});const a=s(141).Z.create({baseUrl:"https://jsproject.webcademy.ru",credentials:"omit",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),n={loadAllProducts:()=>a.get("/items"),loadProduct:t=>a.get(`/items/${t}`),loadProductById:t=>t.length<1?[]:a.get(`/items?ids=${t.join(",")}`),loadFilterProducts:t=>a.get(t)}},319:(t,e,s)=>{s.a(t,(async(t,a)=>{try{s.d(e,{Z:()=>m});var n=s(215),i=s(715),o=s(838),r=s(156),l=s(214),d=t([i,r]);[i,r]=d.then?(await d)():d;const c=[i.uD,o.dw,r.GW,l.Hn],_={...i.LY,...o.v7,...r.YU,...l.Ap},p=new n.Z(c,_),u=Symbol.for("storeKey");globalThis[u]=p;const m=globalThis[u];a()}catch(t){a(t)}}))},598:(t,e,s)=>{s.d(e,{X:()=>a});const a=t=>(t=String(t)).length<4?t:Number(t).toLocaleString("ru-RU")}}]);