"use strict";(self.webpackChunkjavascript_framework_shop=self.webpackChunkjavascript_framework_shop||[]).push([[197],{296:(t,e,s)=>{s.a(t,(async(t,i)=>{try{s.d(e,{Z:()=>d});var r=s(771),a=s(598),n=s(811),o=s(214),c=s(319),l=t([c]);c=(l.then?(await l)():l)[0];class d extends r.Z{constructor(t={}){super(),this._id=t.id,this._scu=t.scu,this._title=t.title,this._complexName=t.complex_name,this._square=t.square,this._priceSqM=t.price_sq_m,this._priceTotal=t.price_total,this._floor=t.floor,this._floorsTotal=t.floors_total,this._rooms=t.rooms,this._image=t.image,this._init()}async _afterInit(){await this._loadData(),await this._updateData()}async _loadData(){}async _updateData(){c.Z.subscribe(o.Uw,(()=>{c.Z.getState("favourites").includes(this._id)?this._elements.favorite.classList.add("product-card__favorite--active"):this._elements.favorite.classList.remove("product-card__favorite--active")}))}_initComponent(){this._component=document.createElement("article"),this._component.classList.add("product-card"),this._component.append(this._link())}_link(){const t=c.Z.getState("favourites").includes(this._id)?"product-card__favorite--active":"";return new n.Z({url:`/javascript-framework-shop/item/${this._id}`,attributes:{class:"product-card__link","data-id":this._id},html:`\n          <header class="product-card__header">\n            <h2 class="product-card__title">ЖК ${this._complexName}</h2>\n            <span class="product-card__favorite ${t}" data-el="favorite" tabindex="0">\n              <svg width="24" height="24"><use xlink:href="#icon-heart"></use></svg>\n            </span>\n          </header>\n          <p class="product-card__pic">\n            <img class="product-card__img" width="300" height="300" src="${this._image}" alt="ЖК ${this._complexName}" loading="lazy">\n          </p>\n          <div class="product-card__desc">\n            <p class="product-card__price">\n              <b class="product-card__price-total">${(0,a.X)(this._priceTotal)} ₸</b>\n              <span class="product-card__price-square">${(0,a.X)(this._priceSqM)} ₸/м<sup>2</sup></span>\n            </p>\n            <dl class="product-card__param">\n              <dt class="product-card__param-title">Комнат</dt>\n              <dd class="product-card__param-desc">${this._rooms}</dd>\n              <dt class="product-card__param-title">Площадь</dt>\n              <dd class="product-card__param-desc">${this._square}</dd>\n            </dl>\n          </div>\n          <footer class="product-card__footer">\n            <span class="product-card__scu">${this._scu}</span>\n            <span class="product-card__floor">Этаж ${this._floor} из ${this._floorsTotal}</span>\n          </footer>\n    `}).component}_initListeners(){const t=t=>{void 0!==t&&c.Z.dispatch((0,o.IR)(t))};this._elements.favorite.addEventListener("click",(e=>{if(e.currentTarget.closest(".product-card__link")){e.preventDefault(),e.stopPropagation();const{id:s}=e.currentTarget.closest(".product-card__link").dataset;t(s)}})),this._elements.favorite.addEventListener("keydown",(e=>{const{id:s}=e.currentTarget.closest(".product-card__link").dataset;"Enter"===e.key&&t(s)}))}}i()}catch(t){i(t)}}))},828:(t,e,s)=>{s.a(t,(async(t,i)=>{try{s.d(e,{Z:()=>o});var r=s(771),a=s(296),n=t([a]);a=(n.then?(await n)():n)[0];class o extends r.Z{_products=[];constructor(t=[]){super(),this._products=t,this._init()}async _afterInit(){await this._loadData(),await this._updateData()}async _loadData(){}async _updateData(){}_initComponent(){const t=document.createElement("div"),e=this._list(this._products);t.append(e),this._component=t.firstElementChild}_list(t=[]){const e=document.createElement("ul");if(e.classList.add("card-list"),t.length<1){const t=document.createElement("li");return t.classList.add("card-list__item"),t.innerHTML="Товаров нет.",e.append(t),e}const s=t.map((t=>{const e=document.createElement("li"),s=new a.Z(t);return e.classList.add("card-list__item"),e.append(s.component),e}));return e.append(...s),e}_initListeners(){}}i()}catch(t){i(t)}}))},771:(t,e,s)=>{s.d(e,{Z:()=>i});class i{_component=null;_elements={};_components={};_abortController=new AbortController;constructor(){if("BaseComponent"===this.constructor.name)throw new TypeError("Абстрактный класс!")}get _template(){return""}get component(){return this._component}get elements(){return this._elements}_setComponents(t){this._components=t}_reloadComponents(t){this._setComponents(t),this._initComponents()}_init(){this._beforeInit().then(),this._initComponent(),this._initElements(),this._initComponents(),this._initListeners(),this._afterInit().then()}async _beforeInit(){}async _afterInit(){}_loadData(){}_updateData(){}_initComponent(){const t=document.createElement("div");t.innerHTML=this._template,this._component=t.firstElementChild||t}_initElements(t=this._component){t.querySelectorAll("[data-el]").forEach((t=>{const e=t.dataset.el;this._elements[e]=t}))}_initComponents(){for(const t of Object.keys(this._components)){let e=this._elements[t];const{component:s}="object"!=typeof this._components[t]||Array.isArray(this._components[t])?new this._components[t]:this._components[t];e&&s&&(s.dataset.el=e.dataset.el,this._elements[e.dataset.el]=s,e.insertAdjacentElement("beforebegin",s),e.remove(),e=null,this._initElements(s))}}_initListeners(){}update(t={}){for(const[e,s]of Object.entries(t))this._elements[e]&&(this._elements[e].innerHTML=s)}destroy(){this._remove(),this._removeListeners()}_remove(){this._component.innerHTML="",this._elements={}}_removeListeners(){this._abortController.abort()}}},44:(t,e,s)=>{s.d(e,{Z:()=>r});var i=s(771);class r extends i.Z{_layout=s.e(220).then(s.bind(s,220));_title="JavaScript framework";constructor(){super(),document.title="Главая страница"}get layout(){return this._layout}}},811:(t,e,s)=>{s.d(e,{Z:()=>a});var i=s(286),r=s(771);class a extends r.Z{static _links=[];constructor({url:t="",html:e="",attributes:s={},activeClass:r="active"}={}){super(),this._router=i.Z.instance,this._url=this._correctUrl(t),this._html=e,this._attributes=s,this._activeClass=r,this._init()}get router(){return this._router}get activeClass(){return this._activeClass}_correctUrl(t){return this._router.history===i.Z.createWebHashHistory()&&(t=t.replace(/^\//,"/#/")),t}_initComponent(){this._component=document.createElement("a"),this._url===this._router.getUri()&&this._component.classList.add(this._activeClass),this._component.setAttribute("href",this._url),this._component.innerHTML=this._html,Object.entries(this._attributes).forEach((([t,e])=>{this._component.setAttribute(t,`${e}`)})),a._links.push({link:this._component,activeClass:this._activeClass})}_initListeners(){this._component.addEventListener("click",(async t=>{t.preventDefault();const e=t.currentTarget.getAttribute("href");window.history.pushState(null,null,e),this._toggleClass(),await this._router.render()})),window.addEventListener(this._router.history,(()=>this._toggleClass()),{signal:this._abortController.signal})}_toggleClass(){a._links.forEach((({link:t,activeClass:e})=>{new URL(t.href).pathname===this._router.getUri()?t.classList.add(e):t.classList.remove(e)}))}}},141:(t,e,s)=>{s.d(e,{Z:()=>i});class i{static _initialization=!1;_options={};_baseUrl="";constructor(){if(!i._initialization)throw new TypeError("Нельзя напрямую создать экземпляр данного класса")}static create(t={}){i._initialization=!0;const e=new i;return i._initialization=!1,e._baseUrl=t.baseUrl??"",delete t.baseUrl,e._options=t,e}_response=async(t,e={})=>{try{const s=await fetch(t,e);return await s.json()}catch(t){throw t}};get(t=""){return t=new URL(t,this._baseUrl),this._response(t.href,this._options)}post(t="",e={}){return t=new URL(t,this._baseUrl),this._options={...this._options,method:"post",body:e},this._response(t.href,this._options)}}},215:(t,e,s)=>{s.d(e,{Z:()=>i});class i{_reducers=[];_state={};_listeners={};constructor(t=[],e={}){this._reducers=t,this._state=e}getState(t=""){return this._state[t]?this._state[t]:this._state}_setState(t){this._state=t}subscribe(t,e){return this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e),()=>{this._listeners=this._listeners[t].filter((t=>t!==e))}}dispatch(t){for(const e of this._reducers){const s=e(this.getState(),t);if(s){this._setState(s);const e=this._listeners[t.type];if(e){const t=this.getState();for(const s of e)s(t)}}}}}},156:(t,e,s)=>{s.a(t,(async(t,i)=>{try{s.d(e,{GW:()=>l,YU:()=>c,pA:()=>n,sH:()=>a});var r=s(554);const{loadBids:t}=r.default,a="REFRESH_BIDS",n=t=>({type:a,bids:t}),o=await t(),c={bids:o,countBids:o.length},l=(t,e)=>e.type===a?(t.bids=e.bids,{...t}):null;i()}catch(t){i(t)}}),1)},214:(t,e,s)=>{s.d(e,{Ap:()=>a,Hn:()=>n,IR:()=>r,Uw:()=>i});const i="TOGGLE_FAVOURITE",r=t=>({type:i,favourite:t}),a={favourites:JSON.parse(localStorage.getItem("favourites"))??[]},n=(t,e)=>{if(e.type===i){if(t.favourites.includes(e.favourite)){const s=t.favourites.filter((t=>t!==e.favourite));return localStorage.setItem("favourites",JSON.stringify(s)),{...t,favourites:s}}return t.favourites.push(e.favourite),localStorage.setItem("favourites",JSON.stringify(t.favourites)),{...t}}return null}},715:(t,e,s)=>{s.a(t,(async(t,i)=>{try{s.d(e,{LY:()=>_,MN:()=>c,U3:()=>d,Xm:()=>n,dj:()=>a,dq:()=>o,sx:()=>l,uD:()=>h});var r=s(42);const{loadAllProducts:t}=r.default,a="SUBMIT_FILTER",n="RESET_FILTER",o="SORT_FILTER",c=t=>({type:a,product:t}),l=()=>({type:n}),d=t=>({type:o,product:t}),_={products:await t()},h=(t,e)=>{switch(e.type){case a:case o:return t.products=e.product,{...t};case n:return{...t,..._};default:return null}};i()}catch(t){i(t)}}),1)},838:(t,e,s)=>{s.d(e,{dw:()=>n,kI:()=>r,v7:()=>a,xe:()=>i});const i="SORT_PRODUCT",r=t=>({type:i,product:t}),a={directions:{complex:"asc",rooms:"asc",square:"asc",priceSqM:"asc",priceTotal:"asc"}},n=(t,e)=>e.type===i?(t.products=e.product,{...t}):null},554:(t,e,s)=>{s.d(e,{default:()=>n});var i=s(141);const r=i.Z.create({baseUrl:"https://jsproject.webcademy.ru",credentials:"omit",headers:{"Content-Type":"application/json; charset=UTF-8"}}),a=i.Z.create({baseUrl:"https://jsproject.webcademy.ru",credentials:"omit",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),n={addBid:t=>r.post("/bidnew",t),loadBids:()=>a.get("/bids")}},42:(t,e,s)=>{s.d(e,{default:()=>r});const i=s(141).Z.create({baseUrl:"https://jsproject.webcademy.ru",credentials:"omit",headers:{"Content-Type":"application/x-www-form-urlencoded"}}),r={loadAllProducts:()=>i.get("/items"),loadProduct:t=>i.get(`/items/${t}`),loadProductById:t=>t.length<1?[]:i.get(`/items?ids=${t.join(",")}`),loadFilterProducts:t=>i.get(t)}},319:(t,e,s)=>{s.a(t,(async(t,i)=>{try{s.d(e,{Z:()=>u});var r=s(215),a=s(715),n=s(838),o=s(156),c=s(214),l=t([a,o]);[a,o]=l.then?(await l)():l;const d=[a.uD,n.dw,o.GW,c.Hn],_={...a.LY,...n.v7,...o.YU,...c.Ap},h=new r.Z(d,_),p=Symbol.for("storeKey");globalThis[p]=h;const u=globalThis[p];i()}catch(t){i(t)}}))},598:(t,e,s)=>{s.d(e,{X:()=>i});const i=t=>(t=String(t)).length<4?t:Number(t).toLocaleString("ru-RU")}}]);